<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZAW GYI & PAI- 13DIGIT AI PREDICTOR</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    html, body {
      min-height: 100%;
      font-family: 'Share Tech Mono', monospace;
      background: linear-gradient(135deg, #0a1929, #142850);
      color: #00ffcc;
      touch-action: manipulation;
    }
    .container {
      max-width: 96%;
      min-height: 100vh;
      margin: 0 auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 1;
    }
    .header {
      margin-bottom: 5px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(0, 255, 204, 0.3);
      text-align: center;
      animation: fadeIn 1s ease;
      position: relative;
    }
    h1 {
      color: #4fc3f7;
      font-size: 1.6rem;
      margin-bottom: 5px;
      letter-spacing: 3px;
    }
    .subtitle {
      color: #e0f7fa;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    .header-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .btn-sound {
      background: linear-gradient(135deg, #448aff, #2979ff);
    }

    .btn-key-time {
      background: linear-gradient(135deg, #b388ff, #7c4dff);
    }
    .content {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .stats-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 10px;
    }
    .stat-box {
      height: 80px;
      flex: 1;
      background: rgba(10, 25, 41, 0.8);
      border: 1px solid rgba(79, 195, 247, 0.3);
      border-radius: 12px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    .stat-title {
      font-size: 1.2rem;
      color: #b3e5fc;
      margin-bottom: 0px;
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .win {
      color: #76ff03;
      text-shadow: 0 0 8px rgba(118, 255, 3, 0.6);
    }
    .lose {
      color: #ff5252;
    }
    .warning-container {
      background: rgba(121, 13, 13, 0.8);
      border: 1px solid rgba(255, 82, 82, 0.5);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 0px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      animation: pulse 2s infinite;
    }
    .warning-text {
      font-size: 1rem;
      color: #ffff;
      text-align: center;
      font-weight: bold;
    }
    @keyframes pulse {
      0% { opacity: 0.8; }
      50% { opacity: 1; }
      100% { opacity: 0.8; }
    }
    .pattern-display {
      background: rgba(10, 25, 41, 0.8);
      border: 1px solid rgba(79, 195, 247, 0.3);
      border-radius: 12px;
      padding: 15px 10px;
      margin: 10px 0;
      min-height: 90px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 5px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    .digit {
      width: 32px;
      height: 42px;
      border-radius: 10px;
      background: linear-gradient(135deg, #1a237e, #283593);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.2rem;
      color: #82b1ff;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    .digit.B {
      background: linear-gradient(135deg, #d32f2f, #b71c1c);
      color: #ffcdd2;
      box-shadow: 0 4px 8px rgba(211, 47, 47, 0.4);
    }
    .digit.S {
      background: linear-gradient(135deg, #1976d2, #0d47a1);
      color: #bbdefb;
      box-shadow: 0 4px 8px rgba(25, 118, 210, 0.4);
    }
    .digit.placeholder {
      opacity: 0.3;
      background: rgba(30, 30, 70, 0.5);
    }
    .result-container {
      margin: 15px 0;
      margin-top: 0px;
      margin-bottom: -8px;
      padding: 15px;
      border-radius: 12px;
      border: 2px solid rgba(79, 195, 247, 0.5);
      background: rgba(10, 25, 41, 0.8);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    .result-header {
      color: #ff6b81;
      margin-bottom: 15px;
      font-size: 1rem;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .prediction {
      font-size: 3.5rem;
      color: #4fc3f7;
      margin: 15px 0;
      text-shadow: 0 0 15px rgba(79, 195, 247, 0.8);
      text-align: center;
      min-height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .prediction.win {
      color: #76ff03;
      text-shadow: 0 0 15px rgba(118, 255, 3, 0.8);
    }
    .prediction.lose {
      color: #ff5252;
      text-shadow: 0 0 15px rgba(255, 82, 82, 0.8);
    }
    .confidence {
      font-size: 1.2rem;
      color: #ffd54f;
      text-align: center;
      min-height: 3px;
      text-shadow: 0 0 8px rgba(255, 213, 79, 0.6);
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .btn {
      padding: 14px 5px;
      font-size: 1.1rem;
      border-radius: 12px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      touch-action: manipulation;
      pointer-events: auto;
      z-index: 2000;
    }
    .btn-big {
      background: linear-gradient(135deg, #ff5252, #d32f2f);
    }
    .btn-small {
      background: linear-gradient(135deg, #448aff, #2979ff);
    }
    .btn-win {
      background: linear-gradient(135deg, #69f0ae, #00e676);
    }
    .btn-lose {
      background: linear-gradient(135deg, #ff5252, #ff1744);
    }
    .btn-delete {
      grid-column: span 2;
      background: linear-gradient(135deg, #b388ff, #7c4dff);
      font-size: 1rem;
    }
    .btn-clear {
      background: linear-gradient(135deg, #ff6e40, #ff3d00);
      font-size: 1rem;
    }
    .status {
      margin-top: 15px;
      font-size: 0.9rem;
      color: #ffd54f;
      text-align: center;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .spinner {
      border: 4px solid rgba(79, 195, 247, 0.3);
      border-top: 4px solid #4fc3f7;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .footer {
      margin-top: 15px;
      font-size: 0.8rem;
      color: #b3e5fc;
      text-align: center;
      padding: 10px 0;
      border-top: 1px solid rgba(79, 195, 247, 0.3);
    }
    .no-match {
      color: #ff5252;
      font-size: 1.1rem;
      text-align: center;
      padding: 10px;
      display: none;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      z-index: 3000;
      opacity: 0;
      transform: translateX(100px);
      transition: all 0.3s ease;
      max-width: 300px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }
    .notification.success {
      background: linear-gradient(135deg, #69f0ae, #00c853);
      border-left: 5px solid #00e676;
    }
    .notification.error {
      background: linear-gradient(135deg, #ff5252, #d50000);
      border-left: 5px solid #ff1744;
    }
    .notification.info {
      background: linear-gradient(135deg, #448aff, #2962ff);
      border-left: 5px solid #2979ff;
    }
    .notification.warning {
      background: linear-gradient(135deg, #ffab40, #ff9100);
      border-left: 5px solid #ff6d00;
    }
    .additional-controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      backdrop-filter: blur(4px);
    }
    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background: linear-gradient(135deg, #0a1929, #142850);
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      max-width: 450px;
      width: 90%;
      border: 2px solid rgba(79, 195, 247, 0.3);
      transform: scale(0.9);
      transition: all 0.3s ease;
    }
    .modal-overlay.show .modal {
      transform: scale(1);
    }
    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid rgba(79, 195, 247, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title {
      font-size: 1.2rem;
      color: #4fc3f7;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #b3e5fc;
      cursor: pointer;
      padding: 5px;
      border-radius: 6px;
      transition: all 0.3s ease;
      touch-action: manipulation;
      pointer-events: auto;
    }
    .modal-close:hover, .modal-close:active {
      background: rgba(79, 195, 247, 0.2);
    }
    .modal-body {
      padding: 20px;
    }
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid rgba(79, 195, 247, 0.3);
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #b3e5fc;
      font-size: 0.9rem;
    }
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #4fc3f7;
      border-radius: 8px;
      background: rgba(20, 40, 60, 0.8);
      color: white;
      font-family: 'Share Tech Mono', monospace;
      font-size: 1rem;
    }
    .form-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.3);
    }
    .btn-key {
      background: linear-gradient(135deg, #00b0ff, #0091ea);
      border: none;
      border-radius: 8px;
      color: white;
      padding: 12px 20px;
      font-family: 'Share Tech Mono', monospace;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 176, 255, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      touch-action: manipulation;
      pointer-events: auto;
    }
    .btn-key:hover, .btn-key:active {
      background: linear-gradient(135deg, #0091ea, #0077c2);
    }
    .btn-contact {
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      border: none;
      border-radius: 8px;
      color: white;
      padding: 10px 15px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 15px;
      width: 100%;
      justify-content: center;
      touch-action: manipulation;
      pointer-events: auto;
    }
    .btn-contact:hover, .btn-contact:active {
      background: linear-gradient(135deg, #3a0ca3, #7209b7);
    }
    .access-message {
      text-align: center;
      margin-top: 15px;
      color: #b3e5fc;
      font-size: 0.9rem;
    }
    @media (min-width: 1200px) {
      .container {
        max-width: 600px;
      }
      h1 {
        font-size: 2.2rem;
      }
      .subtitle {
        font-size: 1rem;
      }
      .digit {
        width: 40px;
        height: 50px;
        font-size: 1.5rem;
      }
      .btn {
        font-size: 1.3rem;
        padding: 16px 8px;
      }
      .prediction {
        font-size: 4rem;
      }
    }
    @media (min-width: 768px) and (max-width: 1199px) {
      .container {
        max-width: 500px;
      }
      h1 {
        font-size: 2rem;
      }
      .subtitle {
        font-size: 0.9rem;
      }
      .digit {
        width: 38px;
        height: 48px;
        font-size: 1.4rem;
      }
      .btn {
        font-size: 1.2rem;
        padding: 16px 5px;
      }
      .prediction {
        font-size: 3.5rem;
      }
    }
    @media (max-width: 767px) {
      .container {
        padding: 10px;
      }
      h1 {
        font-size: 1.4rem;
      }
      .subtitle {
        font-size: 0.8rem;
      }
      .digit {
        width: 28px;
        height: 38px;
        font-size: 1rem;
      }
      .btn {
        font-size: 1rem;
        padding: 12px 5px;
      }
      .prediction {
        font-size: 2.5rem;
      }
      .notification {
        max-width: 80%;
        right: 10px;
        top: 10px;
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      .header-controls {
        gap: 8px;
      }
    }
    @media (max-width: 480px) {
      .container {
        padding: 8px;
      }
      h1 {
        font-size: 1.2rem;
      }
      .subtitle {
        font-size: 0.7rem;
      }
      .digit {
        width: 24px;
        height: 34px;
        font-size: 0.9rem;
      }
      .btn {
        font-size: 0.9rem;
        padding: 10px 4px;
      }
      .prediction {
        font-size: 2rem;
      }
      .confidence {
        font-size: 1rem;
      }
      .stats-container {
        flex-direction: column;
        gap: 8px;
      }
      .stat-box {
        height: 70px;
      }
      .stat-title {
        font-size: 1rem;
      }
      .stat-value {
        font-size: 1.3rem;
      }
      .header-controls {
        gap: 6px;
      }
    }
    @media (max-height: 700px) {
      .container {
        gap: 8px;
      }
      .header {
        margin-bottom: 5px;
        padding-bottom: 5px;
      }
      .stats-container, .warning-container {
        margin-bottom: 8px;
      }
      .pattern-display {
        min-height: 70px;
        padding: 10px 5px;
        margin: 8px 0;
      }
      .result-container {
        margin: 10px 0;
        padding: 10px;
      }
      .prediction {
        font-size: 2.8rem;
        margin: 10px 0;
        min-height: 50px;
      }
      .btn {
        padding: 10px 5px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div id="notification" class="notification">
    <i class="fas fa-info-circle"></i>
    <span class="notification-text"></span>
  </div>
  
  <audio id="notificationSound" src="https://www.soundjay.com/buttons/button-09a.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://www.soundjay.com/buttons/button-3.mp3" preload="auto"></audio>
  <audio id="loseSound" src="https://www.soundjay.com/buttons/button-10.mp3" preload="auto"></audio>
  
  <div class="modal-overlay" id="keyModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">
          <i class="fas fa-key"></i>
          License Key Access
        </div>
        <button class="modal-close" onclick="closeModal('keyModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Enter License Key</label>
          <input type="text" id="licenseKeyInput" class="form-input" placeholder="Enter your license key">
        </div>
        <button class="btn-key" onclick="validateLicenseKey()">
          <i class="fas fa-unlock"></i>
          Validate Key
        </button>
        <div class="access-message" id="accessMessage">
          Enter a valid license key to access the AI predictor
        </div>
        <button class="btn-contact" onclick="contactDeveloper()">
          <i class="fas fa-paper-plane"></i>
          Contact Developer: @leostrike223
        </button>
      </div>
    </div>
  </div>
  
  <div class="container" id="mainApp" style="display: none;">
    <div class="header">
      <h1><i class="head"></i> ZAW GYI/PAI-13DIGIT AI</h1>
      <div class="subtitle">AI Matching Predictor with Enhanced Win/Lose Logic</div>
      <div class="header-controls">
        <button class="btn btn-sound" id="soundToggle" style="font-size: 1rem; padding: 10px;"><i class="fas fa-volume-up"></i> Sound On</button>
        <button class="btn btn-key-time" id="keyTimeBtn"style="font-size: 1rem; padding: 10px;"><i class="fas fa-clock"></i> Check Key's Time</button>
      </div>
    </div>
    
    <div class="content">
      <div class="stats-container">
        <div class="stat-box">
          <div class="stat-title">WIN COUNT</div>
          <div class="stat-value win" id="winCount">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-title">LOSE COUNT</div>
          <div class="stat-value lose" id="loseCount">0</div>
        </div>
      </div>
      
      <div class="warning-container">
        <div class="warning-text">
          <i class="fas fa-exclamation-triangle"></i> Warning: Apk သူခိုးများရှိသည် သတိထားပါ။
        </div>
      </div>
      
      <div class="pattern-display" id="patternDisplay"></div>
      
      <div class="no-match" id="noMatchMessage">
        <i class="fas fa-exclamation-triangle"></i> No matching pattern in AI
      </div>
      
      <div class="result-container">
        <div class="result-header">AI SERVER RESULT</div>
        <div class="prediction" id="prediction">?</div>
        <div class="confidence" id="confidence">Waiting for pattern input...</div>
        <div class="spinner" id="spinner"></div>
      </div>
      <div class="status" id="status">
        <i class="fas fa-info-circle"></i> Enter (B/S) for prediction
      </div>
    </div>
    
    <div class="controls">
      <button class="btn btn-big" id="btnBig"><i></i> BIG</button>
      <button class="btn btn-small" id="btnSmall"><i></i> SMALL</button>
      <button class="btn btn-win" id="btnWin"><i></i> WIN</button>
      <button class="btn btn-lose" id="btnLose"><i></i> LOSE</button>
      <button class="btn btn-delete" id="btnDelete"><i></i> DELETE LAST</button>
    </div>
    
    <div class="additional-controls">
      <button class="btn btn-clear" id="btnClear"><i></i> CLEAR ALL DATA</button>
    </div>
    
    <div class="footer">
      <i class="fas fa-copyright"></i> AI Prediction System 2025 | Win reduces lose count by 1
      <div style="margin-top: 5px;"></div>
    </div>
  </div>

  <script>
    const licenseFirebaseConfig = {
      apiKey: "AIzaSyBNDFi-i58PXRAu0w57armj_Dpn42X6i5g",
      authDomain: "admin-panel-17295.firebaseapp.com",
      databaseURL: "https://admin-panel-17295-default-rtdb.firebaseio.com",
      projectId: "admin-panel-17295",
      storageBucket: "admin-panel-17295.firebasestorage.app",
      messagingSenderId: "185281989467",
      appId: "1:185281989467:web:e47fb327d0c4223483287e",
      measurementId: "G-63JZ6YDWXQ"
    };
    
    const firebaseConfig = {
      apiKey: "AIzaSyAaqQUWLbb1SV64xsJ0CG7_jKW1PzD0MpA",
      authDomain: "zawaung-17bf0.firebaseapp.com",
      databaseURL: "https://zawaung-17bf0-default-rtdb.firebaseio.com",
      projectId: "zawaung-17bf0",
      storageBucket: "zawaung-17bf0.appspot.com",
      messagingSenderId: "1029965895021",
      appId: "1:1029965895021:web:e461ae53aaabcc9e527664"
    };
    
    firebase.initializeApp(firebaseConfig, "appData");
    const db = firebase.database(firebase.app("appData"));
    const licenseApp = firebase.initializeApp(licenseFirebaseConfig, "licenseData");
    const licenseDb = firebase.database(licenseApp);
    
    let inputDigits = [];
    const patternLength = 13;
    let patternMap = {};
    let isProcessing = false;
    let winCount = 0;
    let loseCount = 0;
    let consecutiveLosses = 0;
    let isSoundEnabled = true;
    let lastSoundToggle = 0;
    let lastKeyTimeCheck = 0;
    const patternDisplay = document.getElementById('patternDisplay');
    const predictionEl = document.getElementById('prediction');
    const confidenceEl = document.getElementById('confidence');
    const statusEl = document.getElementById('status');
    const spinner = document.getElementById('spinner');
    const noMatchEl = document.getElementById('noMatchMessage');
    const winCountEl = document.getElementById('winCount');
    const loseCountEl = document.getElementById('loseCount');
    const notificationEl = document.getElementById('notification');
    const mainApp = document.getElementById('mainApp');
    const keyModal = document.getElementById('keyModal');
    const accessMessage = document.getElementById('accessMessage');
    const soundToggle = document.getElementById('soundToggle');
    const keyTimeBtn = document.getElementById('keyTimeBtn');
    const notificationSound = document.getElementById('notificationSound');
    const winSound = document.getElementById('winSound');
    const loseSound = document.getElementById('loseSound');
    
    function toggleSound(e) {
      e.preventDefault();
      e.stopPropagation();
      const now = Date.now();
      if (now - lastSoundToggle < 300) {
        console.log("Sound toggle debounced");
        return;
      }
      lastSoundToggle = now;
      isSoundEnabled = !isSoundEnabled;
      soundToggle.innerHTML = `<i class="fas fa-volume-${isSoundEnabled ? 'up' : 'mute'}"></i> Sound ${isSoundEnabled ? 'On' : 'Off'}`;
      showNotification(`Sound ${isSoundEnabled ? 'enabled' : 'disabled'}`, "info");
      console.log(`Sound toggled to ${isSoundEnabled ? 'on' : 'off'}. Touch support: ${'ontouchstart' in window}`);
    }
    
    function checkKeyTime(e) {
      e.preventDefault();
      e.stopPropagation();
      const now = Date.now();
      if (now - lastKeyTimeCheck < 300) {
        console.log("Key time check debounced");
        return;
      }
      lastKeyTimeCheck = now;
      const expiryTime = localStorage.getItem('licenseExpiry');
      if (expiryTime) {
        const now = Date.now();
        const expiry = parseInt(expiryTime);
        if (now < expiry) {
          const remainingMs = expiry - now;
          const remainingDays = Math.floor(remainingMs / (1000 * 60 * 60 * 24));
          const remainingHours = Math.floor((remainingMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const remainingMinutes = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
          showNotification(`License valid for ${remainingDays} days, ${remainingHours} hours, ${remainingMinutes} minutes`, "info");
        } else {
          showNotification("License key has expired", "error");
          mainApp.style.display = 'none';
          showKeyModal();
        }
      } else {
        showNotification("No valid license key found", "error");
      }
      console.log(`Key time checked. Touch support: ${'ontouchstart' in window}`);
    }
    
    
    function checkLicenseStatus() {
      const savedKey = localStorage.getItem('licenseKey');
      const expiryTime = localStorage.getItem('licenseExpiry');
      
      if (savedKey && expiryTime && Date.now() < parseInt(expiryTime)) {
        mainApp.style.display = 'flex';
        initApp();
      } else {
        showKeyModal();
        if (savedKey) {
          localStorage.removeItem('licenseKey');
          localStorage.removeItem('licenseExpiry');
        }
      }
    }
    
    function showKeyModal() {
      keyModal.classList.add('show');
      mainApp.style.display = 'none';
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('show');
    }
    
    function validateLicenseKey() {
      const key = document.getElementById('licenseKeyInput').value.trim();
      
      if (!key) {
        accessMessage.textContent = "Please enter a license key";
        accessMessage.style.color = "#ff5252";
        return;
      }
      
      accessMessage.textContent = "Validating key...";
      accessMessage.style.color = "#ffd54f";
      
      licenseDb.ref('users/' + key).once('value').then(snapshot => {
        if (snapshot.exists()) {
          const keyData = snapshot.val();
          const now = Date.now();
          
          if (keyData.expiresAt > now) {
            if (keyData.userLimit && keyData.chatId) {
              accessMessage.textContent = "This key is already assigned to another user";
              accessMessage.style.color = "#ff5252";
            } else {
              localStorage.setItem('licenseKey', key);
              localStorage.setItem('licenseExpiry', keyData.expiresAt);
              
              if (keyData.userLimit) {
                licenseDb.ref('users/' + key).update({
                  chatId: 'user_' + Math.random().toString(36).substr(2, 9),
                  activationDate: now
                });
              }
              
              accessMessage.textContent = "License key accepted! Access granted.";
              accessMessage.style.color = "#76ff03";
              
              setTimeout(() => {
                closeModal('keyModal');
                mainApp.style.display = 'flex';
                initApp();
              }, 1500);
            }
          } else {
            accessMessage.textContent = "This license key has expired";
            accessMessage.style.color = "#ff5252";
          }
        } else {
          accessMessage.textContent = "Invalid license key";
          accessMessage.style.color = "#ff5252";
        }
      }).catch(error => {
        accessMessage.textContent = "Error validating key: " + error.message;
        accessMessage.style.color = "#ff5252";
      });
    }
    
    function contactDeveloper() {
      window.open('https://t.me/leostrike223', '_blank');
    }
    
    function showNotification(message, type = 'info') {
      const icon = type === 'success' ? 'fa-check-circle' : 
                  type === 'error' ? 'fa-exclamation-circle' :
                  type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
      
      notificationEl.innerHTML = `<i class="fas ${icon}"></i> <span class="notification-text">${message}</span>`;
      notificationEl.className = `notification ${type}`;
      notificationEl.classList.add('show');
      
      setTimeout(() => {
        notificationEl.classList.remove('show');
      }, 3000);
    }
    
    function playNotificationSound() {
      if (isSoundEnabled) {
        notificationSound.currentTime = 0;
        notificationSound.play().catch(error => {
          console.error("Error playing notification sound:", error);
        });
      }
    }
    
    function playWinSound() {
      if (isSoundEnabled) {
        winSound.currentTime = 0;
        winSound.play().catch(error => {
          console.error("Error playing win sound:", error);
        });
      }
    }
    
    function playLoseSound() {
      if (isSoundEnabled) {
        loseSound.currentTime = 0;
        loseSound.play().catch(error => {
          console.error("Error playing lose sound:", error);
        });
      }
    }
    
    function loadPatternMap() {
      spinner.style.display = 'block';
      statusEl.textContent = "Loading pattern data from Firebase...";
      
      patternMap = {
        "SBSSB": "B",
        "BSSBS": "B",
        "BSBBS": "B",
        "BBSBS": "S",
        "BBBSB": "B",
        "BBBBB": "B",
        "SSSSS": "B",
        "SSBBS": "B",
        "BBBBS": "S",
        "SBBSS": "S",
        "BSSSS": "B",
        "SSSSB": "S",
        "SSSBS": "B",
        "SBSBS": "S",
        "BSBSB": "S",
        "SBSBB": "S",
        "SSBSB": "S",
        "BSBSS": "B",
        "BBSSS": "S",
        "BBSSB": "B",
        "BSSBB": "S",
        "SSBBB": "B",
        "SBBBS": "B",
        "BBBSS": "B",
        "BSSSB": "B",
        "SBBSB": "B",
        "BBSBB": "B",
        "BSBBB": "S",
        "SBBBB": "S",
        "SSBSS": "S",
        "SBSSS": "B",
        "SSSSB": "B",
        "SSSBB": "S"
      };
      
      console.log("PatternMap Loaded:", Object.keys(patternMap).length + " patterns");
      spinner.style.display = 'none';
      statusEl.textContent = `Enter pattern (B/S)`;
      noMatchEl.style.display = 'none';
      showNotification("Pattern data loaded successfully", "success");
    }
    
    function updatePatternDisplay() {
      patternDisplay.innerHTML = '';
      
      inputDigits.forEach(d => {
        const digitEl = document.createElement('div');
        digitEl.className = `digit ${d}`;
        digitEl.textContent = d;
        patternDisplay.appendChild(digitEl);
      });
      
      const remaining = patternLength - inputDigits.length;
      for (let i = 0; i < remaining; i++) {
        const placeholder = document.createElement('div');
        placeholder.className = 'digit placeholder';
        placeholder.textContent = '_';
        patternDisplay.appendChild(placeholder);
      }
    }
    
    function shouldReversePrediction() {
      if (consecutiveLosses <= 0) return false;
      
      const cycle = Math.floor((consecutiveLosses - 1) / 2) + 1;
      const positionInCycle = (consecutiveLosses - 1) % 2;
      
      if (cycle % 2 === 1) {
        return positionInCycle === 0;
      } else {
        return positionInCycle === 1;
      }
    }
    
    function findBestMatch() {
      if (inputDigits.length < patternLength) return null;
      
      const lastFive = inputDigits.slice(-5).join('');
      
      if (patternMap[lastFive]) {
        let predictionValue = patternMap[lastFive];
        const shouldReverse = shouldReversePrediction();
        
        if (shouldReverse) {
          predictionValue = predictionValue === 'B' ? 'S' : 'B';
        }
        
        const displayValue = predictionValue === 'B' ? 'BIG' : 'SMALL';
        const confidence = 100;
        
        return {
          pattern: lastFive,
          value: predictionValue,
          displayValue: displayValue,
          confidence: confidence,
          reversed: shouldReverse
        };
      }
      
      return null;
    }
    
    function showResult() {
      if (isProcessing) return;
      
      isProcessing = true;
      spinner.style.display = 'block';
      predictionEl.textContent = '?';
      predictionEl.classList.remove('win', 'lose');
      confidenceEl.textContent = 'Analyzing pattern...';
      statusEl.textContent = "Connecting to AI server...";
      noMatchEl.style.display = 'none';
      
      setTimeout(() => {
        const match = findBestMatch();
        
        if (match) {
          predictionEl.textContent = match.displayValue;
          predictionEl.classList.remove('win', 'lose');
          let confidenceText = `Confidence: ${match.confidence}%`;
          
          if (match.reversed) {
            confidenceText += " (Reversed Prediction)";
          }
          
          confidenceEl.textContent = confidenceText;
          confidenceEl.style.color = match.confidence > 70 ? '#76ff03' :
                                  match.confidence > 50 ? '#ffd54f' : '#ff5252';
          
          statusEl.textContent = "Prediction complete";
          noMatchEl.style.display = 'none';
          showNotification(`Prediction: ${match.displayValue}${match.reversed ? ' (Reversed)' : ''}`, "success");
          playNotificationSound();
        } else {
          predictionEl.textContent = '?';
          predictionEl.classList.remove('win', 'lose');
          confidenceEl.textContent = '';
          statusEl.textContent = "No matching pattern found";
          noMatchEl.style.display = 'block';
          showNotification("No matching pattern found", "warning");
          playNotificationSound();
        }
        
        spinner.style.display = 'none';
        isProcessing = false;
      }, 1500);
    }
    
    function handleInput(val) {
      if (inputDigits.length >= patternLength) {
        inputDigits.shift();
      }
      inputDigits.push(val);
      updatePatternDisplay();
      showNotification(`Added ${val} to pattern`, "info");
  
      if (inputDigits.length === patternLength) {
        showResult();
      } else {
        predictionEl.textContent = '?';
        predictionEl.classList.remove('win', 'lose');
        confidenceEl.textContent = '';
        statusEl.textContent = `Enter ${patternLength - inputDigits.length} more digits`;
        noMatchEl.style.display = 'none';
      }
    }
    
    function deleteLastInput() {
      if (inputDigits.length > 0) {
        const removed = inputDigits.pop();
        updatePatternDisplay();
        showNotification(`Removed ${removed} from pattern`, "info");
        
        predictionEl.textContent = '?';
        predictionEl.classList.remove('win', 'lose');
        confidenceEl.textContent = '';
        noMatchEl.style.display = 'none';
        
        if (inputDigits.length === 0) {
          statusEl.textContent = "Enter (B/S) for prediction";
        } else {
          statusEl.textContent = `Enter ${patternLength - inputDigits.length} more digits`;
        }
      } else {
        showNotification("No digits to delete", "warning");
      }
    }
    
    function clearAllData() {
      inputDigits = [];
      updatePatternDisplay();
      predictionEl.textContent = '?';
      predictionEl.classList.remove('win', 'lose');
      confidenceEl.textContent = 'Waiting for pattern input...';
      statusEl.textContent = "Enter (B/S) for prediction";
      noMatchEl.style.display = 'none';
      showNotification("All data cleared", "success");
    }
    
    function handleWin() {
      winCount++;
      winCountEl.textContent = winCount;
      predictionEl.textContent = 'WIN';
      predictionEl.classList.remove('lose');
      predictionEl.classList.add('win');
      confidenceEl.textContent = '';
      showNotification("Win recorded!", "success");
      playWinSound();
      
      if (loseCount > 0) {
        loseCount--;
        loseCountEl.textContent = loseCount;
      }
      
      consecutiveLosses = 0;
    }
    
    function handleLose() {
      loseCount++;
      loseCountEl.textContent = loseCount;
      predictionEl.textContent = 'LOSE';
      predictionEl.classList.remove('win');
      predictionEl.classList.add('lose');
      confidenceEl.textContent = '';
      showNotification("Loss recorded", "warning");
      playLoseSound();
      consecutiveLosses++;
    }
    
    function handleKeyboardInput(e) {
      const key = e.key.toUpperCase();
      if (key === 'B') {
        handleInput('B');
      } else if (key === 'S') {
        handleInput('S');
      }
    }
    
    function initApp() {
      updatePatternDisplay();
      
      const btnBig = document.getElementById('btnBig');
      const btnSmall = document.getElementById('btnSmall');
      const btnWin = document.getElementById('btnWin');
      const btnLose = document.getElementById('btnLose');
      const btnDelete = document.getElementById('btnDelete');
      const btnClear = document.getElementById('btnClear');
      const soundToggle = document.getElementById('soundToggle');
      const keyTimeBtn = document.getElementById('keyTimeBtn');
      
      btnBig.removeEventListener('click', handleInput);
      btnBig.removeEventListener('touchstart', handleInput);
      btnSmall.removeEventListener('click', handleInput);
      btnSmall.removeEventListener('touchstart', handleInput);
      btnWin.removeEventListener('click', handleWin);
      btnWin.removeEventListener('touchstart', handleWin);
      btnLose.removeEventListener('click', handleLose);
      btnLose.removeEventListener('touchstart', handleLose);
      btnDelete.removeEventListener('click', deleteLastInput);
      btnDelete.removeEventListener('touchstart', deleteLastInput);
      btnClear.removeEventListener('click', clearAllData);
      btnClear.removeEventListener('touchstart', clearAllData);
      soundToggle.removeEventListener('click', toggleSound);
      soundToggle.removeEventListener('touchstart', toggleSound);
      keyTimeBtn.removeEventListener('click', checkKeyTime);
      keyTimeBtn.removeEventListener('touchstart', checkKeyTime);
      
      btnBig.addEventListener('click', () => handleInput('B'));
      btnBig.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput('B'); }, { passive: false });
      btnSmall.addEventListener('click', () => handleInput('S'));
      btnSmall.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput('S'); }, { passive: false });
      btnWin.addEventListener('click', handleWin);
      btnWin.addEventListener('touchstart', (e) => { e.preventDefault(); handleWin(); }, { passive: false });
      btnLose.addEventListener('click', handleLose);
      btnLose.addEventListener('touchstart', (e) => { e.preventDefault(); handleLose(); }, { passive: false });
      btnDelete.addEventListener('click', deleteLastInput);
      btnDelete.addEventListener('touchstart', (e) => { e.preventDefault(); deleteLastInput(); }, { passive: false });
      btnClear.addEventListener('click', clearAllData);
      btnClear.addEventListener('touchstart', (e) => { e.preventDefault(); clearAllData(); }, { passive: false });
      soundToggle.addEventListener('click', toggleSound);
      soundToggle.addEventListener('touchstart', toggleSound, { passive: false });
      keyTimeBtn.addEventListener('click', checkKeyTime);
      keyTimeBtn.addEventListener('touchstart', checkKeyTime, { passive: false });
      
      document.removeEventListener('keydown', handleKeyboardInput);
      document.addEventListener('keydown', handleKeyboardInput);
      
      loadPatternMap();
      
      showNotification("Welcome to ZAW GYI-13DIGIT AI Predictor", "info");
      console.log("App initialized. Touch support: " + ('ontouchstart' in window));
    }

    // ... existing code ...

    function checkKeyTime(e) {
      e.preventDefault();
      e.stopPropagation();
      const now = Date.now();
      if (now - lastKeyTimeCheck < 300) {
        console.log("Key time check debounced");
        return;
      }
      lastKeyTimeCheck = now;
      const expiryTime = localStorage.getItem('licenseExpiry');
      if (expiryTime) {
        const now = Date.now();
        const expiry = parseInt(expiryTime);
        if (now < expiry) {
          const remainingMs = expiry - now;
          const remainingDays = Math.floor(remainingMs / (1000 * 60 * 60 * 24));
          const remainingHours = Math.floor((remainingMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const remainingMinutes = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
          
          // Show notification for 2 seconds instead of default 3
          const notification = showNotification(`License valid for ${remainingDays} days, ${remainingHours} hours, ${remainingMinutes} minutes`, "info");
          
          // Clear after 2 seconds
          setTimeout(() => {
            if (notification && notification.classList) {
              notification.classList.remove('show');
            }
          }, 2000);
        } else {
          const notification = showNotification("License key has expired", "error");
          
          // Clear after 2 seconds
          setTimeout(() => {
            if (notification && notification.classList) {
              notification.classList.remove('show');
            }
          }, 2000);
          
          mainApp.style.display = 'none';
          showKeyModal();
        }
      } else {
        const notification = showNotification("No valid license key found", "error");
        
        // Clear after 2 seconds
        setTimeout(() => {
          if (notification && notification.classList) {
            notification.classList.remove('show');
          }
        }, 2000);
      }
      console.log(`Key time checked. Touch support: ${'ontouchstart' in window}`);
    }

    // Modify the showNotification function to return the notification element
    function showNotification(message, type = 'info') {
      const icon = type === 'success' ? 'fa-check-circle' : 
                  type === 'error' ? 'fa-exclamation-circle' :
                  type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
      
      notificationEl.innerHTML = `<i class="fas ${icon}"></i> <span class="notification-text">${message}</span>`;
      notificationEl.className = `notification ${type}`;
      notificationEl.classList.add('show');
      
      // Return the notification element so we can reference it later
      return notificationEl;
    }

    // ... rest of the code ...

    
    document.addEventListener('DOMContentLoaded', () => {
      checkLicenseStatus();
    });
  </script>
</body>
</html>
